(this.webpackJsonp=this.webpackJsonp||[]).push([[78],{3582:function(e,t,n){var r=n(563),i=n(3822),o=n(3823);e.exports=function(e,t){return o(e,i(r(t)))}},3583:function(e,t,n){"use strict";(function(e){n.d(t,"d",(function(){return T})),n.d(t,"c",(function(){return A})),n.d(t,"b",(function(){return I})),n.d(t,"a",(function(){return P}));var r=n(2),i=n.n(r),o=n(10),a=n.n(o),s=n(3),c=n.n(s),u=n(13),d=n(78),f=n(126),l=n.n(f),p=n(57),h=n(803),y=n(3584);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m=h.a.Transaction,b=l()(function(){var e=c()((function*(e,t){return t.getCode(e)}));return function(t,n){return e.apply(this,arguments)}}(),{promise:!0});function w(e,t){return x.apply(this,arguments)}function x(){return(x=c()((function*(e,t){var n=e.data,r=e.to;if(r&&"0x"===(yield b(r,t)))return!0;return!n||"0x"===n||"0x0"===n||"0"===n}))).apply(this,arguments)}function T(e,t){return O.apply(this,arguments)}function O(){return(O=c()((function*(t,n){var r=new m(t.encodedTx),i=Object(d.keccak256)(r.encode(!1)),o=yield n.sign(e.from(i.slice(2),"hex")),s=a()(o,2),c=s[0],f=s[1],l=[c.slice(0,32),c.slice(32)],p=l[0],h=l[1],y=new m(g(g({},t.encodedTx),{},{r:Object(u.hexZeroPad)("0x"+p.toString("hex"),32),s:Object(u.hexZeroPad)("0x"+h.toString("hex"),32),v:f}));return{txid:y.hash,rawTx:y.serialize()}}))).apply(this,arguments)}function A(e,t){return k.apply(this,arguments)}function k(){return(k=c()((function*(e,t){if(yield w({data:e.data,to:e.to},t))return{actionType:p.a.NATIVE_TRANSFER,abiDecodeResult:null};try{var n=t.CRC20(e.to),r=p.a.UNKNOWN,i=n.abi.decodeData(e.data);if(i)switch(i.name){case"transfer":r=p.a.TOKEN_TRANSFER;break;case"transferFrom":r=p.a.TOKEN_TRANSFER;var o=i.object,a=o.sender,s=o.recipient;if(a!==e.from&&s!==e.from)return{actionType:p.a.UNKNOWN,abiDecodeResult:null};break;case"approve":r=p.a.TOKEN_APPROVE;break;default:r=p.a.UNKNOWN}return{actionType:r,abiDecodeResult:i}}catch(c){return{actionType:p.a.UNKNOWN,abiDecodeResult:null}}}))).apply(this,arguments)}function I(e){switch(e){case 0:return p.c.Confirmed;case 1:return p.c.Failed;case 2:case null:return p.c.Dropped;default:return p.c.Confirmed}}function P(e){return e?y.a.Transfer20:""===e?y.a.Call:y.a.Transaction}}).call(this,n(19).Buffer)},3584:function(e,t,n){"use strict";var r;n.d(t,"a",(function(){return r})),function(e){e.Transaction="transaction",e.Call="call",e.Transfer20="transfer_20"}(r||(r={}))},3822:function(e,t){e.exports=function(e){if("function"!=typeof e)throw new TypeError("Expected a function");return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}},3823:function(e,t,n){var r=n(941),i=n(563),o=n(2105),a=n(2072);e.exports=function(e,t){if(null==e)return{};var n=r(a(e),(function(e){return[e]}));return t=i(t),o(e,n,(function(e,n){return t(e,n[0])}))}},3824:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return _}));var r=n(3582),i=n.n(r),o=n(2),a=n.n(o),s=n(3),c=n.n(s),u=n(6),d=n.n(u),f=n(9),l=n.n(f),p=n(12),h=n.n(p),y=n(5),v=n.n(y),g=n(67),m=n(27),b=n.n(m),w=n(3581),x=n(56),T=n(3068),O=n(14),A=n(22),k=n(173),I=n(21),P=n(111),N=n(225),j=n(3070),R=n(803);function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var D=R.a.Transaction,F=R.a.address,B="m/44'/"+O.g+"'/0'/0",_=function(t){l()(r,t);var n=C(r);function r(){return n.apply(this,arguments)}var o=r.prototype;return o.signTransaction=function(){var e=c()((function*(e){var t,n,r,o,a,s,c=yield this.getHardwareSDKInstance(),u=yield this.getAccountPath(),d=yield this.getHardwareInfo(),f=d.connectId,l=d.deviceId,p=yield this.getWalletPassphraseState(),h=e.encodedTx,y=S(S({},h),{},{epochHeight:Object(k.b)(new b.a(null!=(t=h.epochHeight)?t:0)),to:h.to?"0x"+F.decodeCfxAddress(h.to).hexAddress.toString("hex"):"",storageLimit:Object(k.b)(new b.a(null!=(n=h.storageLimit)?n:0)),nonce:Object(k.b)(new b.a(null!=(r=h.nonce)?r:0)),gasPrice:Object(k.b)(new b.a(null!=(o=h.gasPrice)?o:0)),data:null!=(a=h.data)?a:"0x",value:Object(k.b)(new b.a(null!=(s=h.value)?s:0))}),v=yield c.confluxSignTransaction(f,l,S({path:u,transaction:y},p));if(v.success){var g=v.payload,m=g.r,w=g.s,x=g.v,O=new D(S(S({},i()(y,(function(e){return!e}))),{},{r:m,s:w,v:new b.a(x).toNumber()}));return Promise.resolve({txid:O.hash,rawTx:O.serialize()})}throw Object(T.a)(v.payload)}));return function(t){return e.apply(this,arguments)}}(),o.signMessage=function(){var e=c()((function*(e,t){var n=this;return Promise.all(e.map(function(){var e=c()((function*(e){return n.handleSignMessage(e)}));return function(t){return e.apply(this,arguments)}}()))}));return function(t,n){return e.apply(this,arguments)}}(),o.prepareAccounts=function(){var e=c()((function*(e){var t,n=this,r=e.indexes,i=e.names,o=r.map((function(e){return B+"/"+e})),a=new b.a(yield this.getNetworkChainId()).toNumber(),s=yield this.getHardwareSDKInstance(),c=yield this.getHardwareInfo(),u=c.connectId,d=c.deviceId,f=yield this.getWalletPassphraseState();try{t=yield s.confluxGetAddress(u,d,S({bundle:o.map((function(e){return{path:e,showOnOneKey:!1,chainId:a}}))},f))}catch(l){throw A.a.common.error(l),new I.o(l)}if(!t.success)throw A.a.common.error(t.payload),Object(T.a)(t.payload);return t.payload.map((function(e,t){var o,a=e.address,s=e.path;return{id:n.walletId+"--"+s,name:(i||[])[t]||"CFX #"+(r[t]+1),type:P.a.VARIANT,path:s,coinType:O.g,pub:"",address:"0x"+F.decodeCfxAddress(null!=a?a:"").hexAddress.toString("hex"),addresses:(o={},o[n.networkId]=null!=a?a:"",o)}})).filter((function(e){return!!e.address}))}));return function(t){return e.apply(this,arguments)}}(),o.getAddress=function(){var e=c()((function*(e){var t,n=yield this.getHardwareSDKInstance(),r=yield this.getHardwareInfo(),i=r.connectId,o=r.deviceId,a=yield this.getWalletPassphraseState(),s=new b.a(yield this.getNetworkChainId()).toNumber(),c=yield n.confluxGetAddress(i,o,S({path:e.path,showOnOneKey:e.showOnOneKey,chainId:s},a));if(c.success&&null!=(t=c.payload)&&t.address)return c.payload.address;throw Object(T.a)(c.payload)}));return function(t){return e.apply(this,arguments)}}(),o.handleSignMessage=function(){var t=c()((function*(t){var n=yield this.getHardwareSDKInstance(),r=yield this.getAccountPath(),i=yield this.getHardwareInfo(),o=i.connectId,a=i.deviceId,s=yield this.getWalletPassphraseState();if(t.type===N.b.TYPED_DATA_V1)throw g.b.provider.unsupportedMethod("Sign message method="+t.type+" not supported for this device");if(t.type===N.b.ETH_SIGN||t.type===N.b.PERSONAL_SIGN){var c;try{if(!Object(x.e)(t.message))throw new Error("not hex string");c=e.from(t.message.replace("0x",""),"hex")}catch(k){c=e.from("")}var u=t.message;0===c.length&&(u=e.from(t.message,"utf-8").toString("hex"));var d=yield n.confluxSignMessage(o,a,S({path:r,messageHex:u},s));if(!d.success)throw Object(T.a)(d.payload);return"0x"+(d.payload.signature||"")}if(t.type===N.b.TYPED_DATA_V3||t.type===N.b.TYPED_DATA_V4){var f,l,p,h=t.type===N.b.TYPED_DATA_V4,y=JSON.parse(t.message),v=w.TypedDataUtils.sanitizeData(y),m=(null==v||null==(f=v.types)||null==(l=f.CIP23Domain)?void 0:l.length)>0?"CIP23Domain":"EIP712Domain",b=w.TypedDataUtils.hashStruct(m,v.domain,v.types,h).toString("hex"),O=w.TypedDataUtils.hashStruct(v.primaryType,v.message,v.types,h).toString("hex"),A=yield n.confluxSignMessageCIP23(o,a,S({path:r,domainHash:b,messageHash:O},s));if(!A.success)throw Object(T.a)(A.payload);return"0x"+((null==A||null==(p=A.payload)?void 0:p.signature)||"")}throw g.b.rpc.methodNotFound("Sign message method="+t.type+" not found")}));return function(e){return t.apply(this,arguments)}}(),d()(r)}(j.a)}).call(this,n(19).Buffer)},5193:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return ue}));var r=n(460),i=n.n(r),o=n(3582),a=n.n(o),s=n(10),c=n.n(s),u=n(143),d=n.n(u),f=n(2),l=n.n(f),p=n(3),h=n.n(p),y=n(6),v=n.n(y),g=n(9),m=n.n(g),b=n(12),w=n.n(b),x=n(5),T=n.n(x),O=n(537),A=n(293),k=n(55),I=n.n(k),P=n(27),N=n.n(P),j=n(126),R=n.n(j),E=n(112),S=n(56),C=n(405),D=n(173),F=n(21),B=n(938),_=n(57),K=n(3095),H=n(3069),V=n(3824),M=n(297),U=n(14),W=n(111),L=n(3071),G=n(3583);function z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T()(e);if(t){var i=T()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w()(this,n)}}var q="m/44'/"+U.g+"'/0'/0",J=function(e){m()(n,e);var t=z(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=h()((function*(e,t){var n,r=yield this.getDbAccount(),i=r.addresses[this.networkId];if(1!==t.length)throw new F.p("CFX signers number should be 1.");if(t[0]!==i)throw new F.p("Wrong address required for signing.");var o=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof o)throw new F.p("Unable to get signer.");return(n={})[i]=new B.b(o,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=h()((function*(e){var t=e.password,n=e.indexes,r=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,o=Object(M.d)("secp256k1",i,t,q,n.map((function(e){return e.toString()})));if(o.length!==n.length)throw new F.p("Unable to get publick key.");var a=[],s=0;for(var c of o){var u,d=c.path,f=c.extendedKey.key.toString("hex"),l=yield this.engine.providerManager.addressFromPub(this.networkId,f),p=yield this.vault.addressToBase(l),h=(r||[])[s]||"CFX #"+(n[s]+1);a.push({id:this.walletId+"--"+d,name:h,type:W.a.VARIANT,path:d,coinType:U.g,pub:f,address:p,addresses:(u={},u[this.networkId]=l,u)}),s+=1}return a}));return function(t){return e.apply(this,arguments)}}(),r.signTransaction=function(){var e=h()((function*(e,t){var n=(yield this.getDbAccount()).addresses[this.networkId],r=(yield this.getSigners(t.password||"",[n]))[n];return Object(G.d)(e,r)}));return function(t,n){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=h()((function*(e,t){var n=this;if("undefined"===typeof t.password)throw new F.p("Software signing requires a password.");var r=(yield this.getDbAccount()).addresses[this.networkId],i=(yield this.getSigners(t.password||"",[r]))[r];return Promise.all(e.map((function(e){return n.engine.providerManager.signMessage(n.networkId,e,i)})))}));return function(t,n){return e.apply(this,arguments)}}(),v()(n)}(L.a),X=n(427);function Y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T()(e);if(t){var i=T()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w()(this,n)}}var Z=function(e){m()(n,e);var t=Y(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=h()((function*(e,t){var n,r=(yield this.getDbAccount()).addresses[this.networkId];if(1!==t.length)throw new F.p("CFX signers number should be 1.");if(t[0]!==r)throw new F.p("Wrong address required for signing.");var i=Object.values(yield this.getPrivateKeys(e)),o=c()(i,1)[0];return(n={})[r]=new B.b(o,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=h()((function*(e){var t,n=e.name,r=e.privateKey;if(32!==r.length)throw new F.p("Invalid private key.");var i=X.c.publicFromPrivate(r).toString("hex"),o=yield this.engine.providerManager.addressFromPub(this.networkId,i),a=yield this.vault.addressToBase(o);return Promise.resolve([{id:"imported--"+U.g+"--"+i,name:n||"",type:W.a.VARIANT,path:"",coinType:U.g,pub:i,address:a,addresses:(t={},t[this.networkId]=o,t)}])}));return function(t){return e.apply(this,arguments)}}(),v()(n)}(n(3072).a);function $(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T()(e);if(t){var i=T()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w()(this,n)}}var Q=function(e){m()(n,e);var t=$(n);function n(){return t.apply(this,arguments)}return n.prototype.prepareAccounts=function(){var e=h()((function*(e){var t,n=e.name,r=e.target,i=e.accountIdPrefix,o=yield this.engine.providerManager.verifyAddress(this.networkId,r),a=o.normalizedAddress;if(!o.isValid||"undefined"===typeof a)throw new F.e;var s=yield this.vault.addressToBase(a);return[{id:i+"--"+U.g+"--"+s,name:n||"",type:W.a.VARIANT,path:"",coinType:U.g,pub:"",address:s,addresses:(t={},t[this.networkId]=a,t)}]}));return function(t){return e.apply(this,arguments)}}(),v()(n)}(n(3073).a),ee=n(803),te=n(2088),ne=n(3584);function re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?re(Object(n),!0).forEach((function(t){l()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):re(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function oe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=T()(e);if(t){var i=T()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return w()(this,n)}}var ae=ee.a.Conflux,se=ee.a.address,ce="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",ue=function(e){m()(n,e);var t=oe(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).settings=te.default,e.keyringMap={hd:J,hw:V.a,imported:Z,watching:Q,external:Q},e.getApiExplorerCache=R()(function(){var e=h()((function*(e){return I.a.create({baseURL:e})}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(S.b)({minute:3})}),e.getClientCache=R()(function(){var t=h()((function*(t,n){return e.getConfluxClient(t,n)}));return function(e,n){return t.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(S.b)({minute:3})}),e.getRpcClientCache=R()(function(){var e=h()((function*(e){return new C.a(e)}));return function(t){return e.apply(this,arguments)}}(),{promise:!0,max:1,maxAge:Object(S.b)({minute:3})}),e}var r=n.prototype;return r.getApiExplorer=function(){var e=h()((function*(){var e=yield this.engine.getNetwork(this.networkId),t=e.blockExplorerURL.name.replace(/(https:\/\/)/,"$1"+(e.isTestnet?"api-":"api."));return this.getApiExplorerCache(t)}));return function(){return e.apply(this,arguments)}}(),r.getClient=function(){var e=h()((function*(e){var t=yield this.getRpcUrl(),n=yield this.getNetworkChainId();return this.getClientCache(null!=e?e:t,n)}));return function(t){return e.apply(this,arguments)}}(),r.getRpcClient=function(){var e=h()((function*(e){var t=yield this.getRpcUrl();return this.getRpcClientCache(null!=e?e:t)}));return function(t){return e.apply(this,arguments)}}(),r.getConfluxClient=function(e,t){return new ae({url:e,networkId:Number(t)})},r.getBalances=function(){var e=h()((function*(e){var t=e.map((function(e){var t=e.address,n=e.tokenAddress;return{address:t,coin:ie({},"string"===typeof n?{tokenAddress:n}:{})}})).map((function(e){var t;return null!=(t=e.coin)&&t.tokenAddress?["cfx_call",[{to:e.coin.tokenAddress,data:"0x70a08231000000000000000000000000"+Object(O.decode)(e.address).hexAddress.toString("hex")},"latest_state"]]:["cfx_getBalance",[e.address,"latest_state"]]})),n=yield this.getRpcClient();return(yield n.batchCall(t,void 0,void 0,!0)).map((function(e){var t;return"undefined"!==typeof e&&(t=Object(D.a)(e.slice(0,66))).isNaN()&&(t=void 0),t}))}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=h()((function*(e){var t=yield this.getNetwork(),n=e.encodedTx,r=e.feeInfoValue,i=r.limit,o=r.price,a=ie({},n);return d()(i)||(a.gas=Object(D.b)(new N.a(i)),a.gasLimit=Object(D.b)(new N.a(i))),d()(o)||(a.gasPrice=Object(K.c)({value:o||"0.000000001",network:t})),Promise.resolve(a)}));return function(t){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){return Promise.resolve({})},r.decodeTx=function(){var e=h()((function*(e,t){var n,r=yield this.getAccountAddress(),i=yield this.getNetwork();return{txid:e.hash||"",owner:r,signer:e.from||r,nonce:e.nonce||0,actions:yield this.buildEncodedTxActions(e),status:_.c.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:e,feeInfo:{limit:e.gasLimit,price:Object(K.d)({value:null!=(n=e.gasPrice)?n:"1",network:i}),priceValue:e.gasPrice},payload:t,extraInfo:null}}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=h()((function*(e){var t=yield this.getNetwork(),n=e.amount,r=Boolean(e.token),i=new N.a(n);if(i.isNaN()&&(i=new N.a("0")),r){var o,a,s=yield this.engine.ensureTokenInDB(this.networkId,null!=(o=e.token)?o:"");if(!s)throw new Error("Token not found: "+e.token);var c=Object(D.b)(i.shiftedBy(s.decimals)),u="0x"+se.decodeCfxAddress(e.to).hexAddress.toString("hex"),d="0xa9059cbb"+A.b.encode(["address","uint256"],[u,c]).slice(2);return{from:e.from,to:null!=(a=e.token)?a:"",value:"0x0",data:d}}var f=Object(D.b)(i.shiftedBy(t.decimals));return{from:e.from,to:e.to,value:f,data:"0x"}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(e){throw new Error("Method not implemented.")},r.updateEncodedTxTokenApprove=function(){var e=h()((function*(e,t){var n=(yield this.decodeTx(e)).actions[0];if(!n||n.type!==_.a.TOKEN_APPROVE||!n.tokenApprove)throw new Error("Not a approve transaction.");var r,i=n.tokenApprove,o=i.tokenInfo,a=i.spender;if("Infinite"===t||t===ce)r=ce;else{var s=new N.a(t);if(s.isNaN())throw new Error("Invalid amount input: "+t);r=Object(D.b)(s.shiftedBy(o.decimals))}var c="0x095ea7b3"+A.b.encode(["address","uint256"],["0x"+se.decodeCfxAddress(a).hexAddress.toString("hex"),r]).slice(2);return ie(ie({},e),{},{data:c})}));return function(t,n){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=h()((function*(e){var t=e.from,n=e.to,r=e.value,i=e.data,o=yield this.getClient(),a=yield Promise.all([o.getStatus(),o.getNextNonce(e.from),o.estimateGasAndCollateral({from:t,to:n,value:r,data:i})]),s=c()(a,3),u=s[0],d=s[1],f=s[2];e.nonce=Number(d),e.epochHeight=u.epochNumber,e.chainId=u.chainId,e.storageLimit=new N.a(f.storageCollateralized).toFixed();var l={inputs:[],outputs:[],payload:{encodedTx:e},encodedTx:e};return Promise.resolve(l)}));return function(t){return e.apply(this,arguments)}}(),r.fetchFeeInfo=function(){var e=h()((function*(e){var t,n=e.gas,r=e.gasLimit,i=yield this.getNetwork(),o=yield this.getClient(),a=e.from,s=e.to,u=e.value,d=e.data,f=yield Promise.all([o.getGasPrice(),o.estimateGasAndCollateral({from:a,to:s,value:u,data:d})]),l=c()(f,2),p=l[0],h=l[1],y=N.a.max(null!=(t=h.gasLimit)?t:"0",null!=n?n:"0",null!=r?r:"0").toFixed();return{nativeSymbol:i.symbol,nativeDecimals:i.decimals,feeSymbol:i.feeSymbol,feeDecimals:i.feeDecimals,limit:y,prices:[new N.a(p.toString()).shiftedBy(-i.decimals).toFixed()],defaultPresetIndex:"1",tx:null}}));return function(t){return e.apply(this,arguments)}}(),r.updateEncodedTx=function(){var e=h()((function*(e,t,n){if(n.type===_.d.transfer){var r=yield this.getNetwork();e.value=new N.a(t.amount).shiftedBy(r.decimals).toFixed()}return Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=h()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=Object.values(yield n.getPrivateKeys(e)),i=c()(r,1)[0];return"0x"+Object(E.a)(e,i).toString("hex")}throw new F.p("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=h()((function*(){var e,t=yield this.getDbAccount({noCache:!0}),n={id:t.id,name:t.name,type:t.type,path:t.path,coinType:t.coinType,tokens:[],address:(null==(e=t.addresses)?void 0:e[this.networkId])||""};if(0===n.address.length){var r=yield this.engine.providerManager.addressFromPub(this.networkId,t.pub);yield this.engine.dbApi.addAccountAddress(t.id,this.networkId,r),n.address=r}return n}));return function(){return e.apply(this,arguments)}}(),r.getAccountAddress=function(){var e=h()((function*(){return(yield this.getOutputAccount()).address}));return function(){return e.apply(this,arguments)}}(),r.getAccountBalance=function(){var e=h()((function*(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=yield this.getAccountAddress();return this.getBalances((t?[{address:n}]:[]).concat(e.map((function(e){return{address:n,tokenAddress:e}}))))}));return function(t){return e.apply(this,arguments)}}(),r.validateAddress=function(){var e=h()((function*(e){var t=se.isValidCfxAddress(e),n=t?e.toLowerCase():void 0;if(!t||"undefined"===typeof n)throw new F.e;return Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.fetchOnChainHistory=function(){var e=h()((function*(e){var t=this,n=e.tokenIdOnNetwork,r=e.localHistory,o=void 0===r?[]:r,s=yield this.getNetwork(),c=yield this.getApiExplorer(),u=yield this.getClient(),f=yield this.getAccountAddress(),l=[],p=Object(G.a)(n),y=a()({account:f,limit:50,transferType:p,contract:n},(function(e){return d()(e)||i()(e)}));try{var v=yield c.get("/account/transfers",{params:y});if(0!==v.data.code)return yield Promise.resolve([]);var g=v.data.data.list.map(function(){var e=h()((function*(e){var r,i=o.find((function(t){return t.decodedTx.txid===e.transactionHash}));if(i&&i.decodedTx.isFinal)return Promise.resolve(null);var a=ie(ie({},e),{},{hash:e.transactionHash,value:p===ne.a.Transfer20?"0x":Object(D.b)(new N.a(e.amount)),data:e.input});if(p!==ne.a.Transaction){var c=yield u.getTransactionByHash(e.transactionHash);if(c&&(a.gasFee=new N.a(c.gas).multipliedBy(c.gasPrice).toFixed(),a.nonce=new N.a(c.nonce).toNumber(),a.data=c.data,p===ne.a.Transfer20&&(a.to=c.to||e.contract||a.to)),p===ne.a.Transfer20){var d=yield t.engine.findToken({networkId:t.networkId,tokenIdOnNetwork:n});d&&l.push({type:_.a.TOKEN_TRANSFER,tokenTransfer:t.buildTokenTransferAction({from:e.from,to:e.to,token:d,amount:e.amount})})}}var h={txid:a.hash||"",owner:f,signer:a.from||f,nonce:a.nonce||0,actions:l.length?l:yield t.buildEncodedTxActions(a),status:Object(G.b)(e.status),networkId:t.networkId,accountId:t.accountId,encodedTx:a,extraInfo:null,totalFeeInNative:new N.a(a.gasFee).shiftedBy(-s.decimals).toFixed()};return h.updatedAt=1e3*e.timestamp,h.createdAt=null!=(r=null==i?void 0:i.decodedTx.createdAt)?r:h.updatedAt,h.isFinal=h.status===_.c.Confirmed,t.buildHistoryTx({decodedTx:h,historyTxToMerge:{}})}));return function(t){return e.apply(this,arguments)}}());return(yield Promise.all(g)).filter(Boolean)}catch(m){return Promise.resolve([])}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxActions=function(){var e=h()((function*(e){var t,n=yield this.getAccountAddress(),r=yield this.getClient(),i=yield Object(G.c)(e,r),o=i.actionType,a=i.abiDecodeResult,s={type:_.a.UNKNOWN,direction:yield this.buildTxActionDirection({from:e.from,to:e.to,address:n}),unknownAction:{extraInfo:{}}};if(e.value){var c=new N.a(e.value);!c.isNaN()&&c.gt(0)&&(t={type:_.a.NATIVE_TRANSFER,nativeTransfer:yield this.buildNativeTransferAction(e)})}if(o===_.a.NATIVE_TRANSFER&&(s.type=_.a.NATIVE_TRANSFER,s.nativeTransfer=yield this.buildNativeTransferAction(e),t=void 0),o===_.a.TOKEN_TRANSFER||o===_.a.TOKEN_APPROVE){var u=yield this.engine.findToken({networkId:this.networkId,tokenIdOnNetwork:e.to});if(u&&a){var d,f,l=a.object,p=l.from,h=l.to,y=l.sender,v=l.recipient,g=l.amount,m=l.spender;if(s.type=o,o===_.a.TOKEN_TRANSFER)s.tokenTransfer=this.buildTokenTransferAction({from:null!=(d=null!=(f=null!=p?p:y)?f:e.from)?d:n,to:null!=h?h:v,token:u,amount:g});o===_.a.TOKEN_APPROVE&&(s.tokenApprove=this.buildTokenApproveAction({owner:e.from||n,spender:m,token:u,amount:g}))}}return[s,t].filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.buildNativeTransferAction=function(){var e=h()((function*(e){var t=yield this.engine.getNativeTokenInfo(this.networkId),n=new N.a(e.value),r=yield this.getNetwork();return{tokenInfo:t,from:e.from,to:e.to,amount:n.shiftedBy(-r.decimals).toFixed(),amountValue:n.toFixed(),extraInfo:null}}));return function(t){return e.apply(this,arguments)}}(),r.buildTokenTransferAction=function(e){var t=e.from,n=e.to,r=e.token,i=e.amount,o=new N.a(i);return{from:t,to:n,tokenInfo:r,amount:o.shiftedBy(-r.decimals).toFixed(),amountValue:o.toFixed(),extraInfo:null}},r.buildTokenApproveAction=function(e){var t=e.owner,n=e.spender,r=e.token,i=e.amount,o=new N.a(i);return{owner:t,spender:n,isMax:Object(D.b)(new N.a(i))===ce,tokenInfo:r,amount:o.shiftedBy(-r.decimals).toFixed(),amountValue:o.toFixed(),extraInfo:null}},r.proxyJsonRPCCall=function(){var e=h()((function*(e){var t=yield this.getClient();try{return t.request(e)}catch(n){throw Object(B.c)(n)}}));return function(t){return e.apply(this,arguments)}}(),r.getClientEndpointStatus=function(){var e=h()((function*(e){var t=yield this.getClient(e),n=performance.now(),r=yield t.getEpochNumber();return{responseTime:Math.floor(performance.now()-n),latestBlock:r}}));return function(t){return e.apply(this,arguments)}}(),r.addressFromBase=function(){var e=h()((function*(e){var t=yield this.getNetworkChainId();return Object(O.encode)(e,parseInt(t))}));return function(t){return e.apply(this,arguments)}}(),r.addressToBase=function(){var e=h()((function*(e){return Promise.resolve("0x"+Object(O.decode)(e).hexAddress.toString("hex"))}));return function(t){return e.apply(this,arguments)}}(),r.fetchTokenInfos=function(e){return this.engine.providerManager.getTokenInfos(this.networkId,e)},v()(n)}(H.a)}}]);