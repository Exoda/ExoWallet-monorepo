(this.webpackJsonp=this.webpackJsonp||[]).push([[80],{3809:function(e,t,n){var r=n(2117),i=n(1174),a=n(1136),o=n(1135),s=a((function(e,t){return o(e)?r(e,i(t,1,o,!0)):[]}));e.exports=s},3810:function(e,t,n){var r=n(3811),i=n(955),a=n(563),o=n(3812),s=n(172);e.exports=function(e,t,n){var d=s(e)?r:o,c=arguments.length<3;return d(e,a(t,4),n,c,i)}},3811:function(e,t){e.exports=function(e,t,n,r){var i=-1,a=null==e?0:e.length;for(r&&a&&(n=e[++i]);++i<a;)n=t(n,e[i],i,e);return n}},3812:function(e,t){e.exports=function(e,t,n,r,i){return i(e,(function(e,i,a){n=r?(r=!1,e):t(n,e,i,a)})),n}},3813:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return b})),n.d(t,"b",(function(){return k})),n.d(t,"c",(function(){return N})),n.d(t,"d",(function(){return F}));var r=n(2),i=n.n(r),a=n(3),o=n.n(a),s=n(13),d=n(78),c=n(119),u=n(67),l=n(27),f=n(3581),p=n(56),h=n(3068),y=n(14),v=n(269),m=n(173),g=n(21),x=n(225);function T(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?T(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):T(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n,r){return P.apply(this,arguments)}function P(){return(P=o()((function*(e,t,n,r){var i,a,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0,d=arguments.length>6?arguments[6]:void 0;try{a=yield e.evmGetAddress(t,n,w({path:r,showOnOneKey:o,chainId:d},s))}catch(c){throw new g.o(c)}if(a.success&&null!=(i=a.payload)&&i.address)return v.b({address:a.payload.address,impl:y.C});throw Object(h.a)(a.payload)}))).apply(this,arguments)}function I(e){if(!e.success)throw Object(h.a)(e.payload);return e.payload}function k(e){return A.apply(this,arguments)}function A(){return(A=o()((function*(t){var n=t.HardwareSDK,r=t.connectId,i=t.deviceId,a=t.passphraseState,o=t.path,s=t.message,d=t.chainId;if(s.type===x.b.TYPED_DATA_V1)throw u.b.provider.unsupportedMethod("Sign message method="+s.type+" not supported for this device");if(s.type===x.b.ETH_SIGN||s.type===x.b.PERSONAL_SIGN){var c;try{if(!Object(p.e)(s.message))throw new Error("not hex string");c=e.from(s.message.replace("0x",""),"hex")}catch(N){c=e.from("")}var l=s.message;0===c.length&&(l=e.from(s.message,"utf-8").toString("hex"));var y=yield n.evmSignMessage(r,i,w({path:o,messageHex:l,chainId:d},a));if(!y.success)throw Object(h.a)(y.payload);var v=I(y);return"0x"+((null==v?void 0:v.signature)||"")}if(s.type===x.b.TYPED_DATA_V3||s.type===x.b.TYPED_DATA_V4){var m=s.type===x.b.TYPED_DATA_V4,g=JSON.parse(s.message),T=f.TypedDataUtils.sanitizeData(g),b=f.TypedDataUtils.hashStruct("EIP712Domain",T.domain,T.types,m).toString("hex"),P=f.TypedDataUtils.hashStruct(T.primaryType,T.message,T.types,m).toString("hex"),k=yield n.evmSignTypedData(r,i,w({path:o,metamaskV4Compat:!!m,data:g,domainHash:b,messageHash:P,chainId:d},a));if(!k.success)throw Object(h.a)(k.payload);var A=I(k);return"0x"+((null==A?void 0:A.signature)||"")}throw u.b.rpc.methodNotFound("Sign message method="+s.type+" not found")}))).apply(this,arguments)}function N(e,t,n,r,i,a,o){return O.apply(this,arguments)}function O(){return(O=o()((function*(e,t,n,r,i,a,o){var u,f,p,y,v=a.outputs[0];if("undefined"===typeof v.tokenAddress?(p=v.address,y=Object(m.b)(v.value)):(p=v.tokenAddress,y="0x0"),"undefined"===typeof a.feeLimit||"undefined"===typeof a.nonce)throw new g.p("Incomplete unsigned tx.");var x,T,b,P,I=null==(u=a.payload)?void 0:u.EIP1559Enabled;I?x={to:p,value:y,gasLimit:Object(m.b)(a.feeLimit),nonce:"0x"+a.nonce.toString(16),data:(null==(T=a.payload)?void 0:T.data)||"0x",chainId:parseInt(i),maxFeePerGas:Object(m.b)(a.payload.maxFeePerGas),maxPriorityFeePerGas:Object(m.b)(a.payload.maxPriorityFeePerGas)}:x={to:p,value:y,gasPrice:Object(m.b)(null!=(b=a.feePricePerUnit)?b:new l.BigNumber(0)),gasLimit:Object(m.b)(a.feeLimit),nonce:"0x"+a.nonce.toString(16),data:(null==(P=a.payload)?void 0:P.data)||"0x",chainId:parseInt(i)};var k,A,N,O,F={to:x.to,value:x.value,gasPrice:x.gasPrice,gasLimit:x.gasLimit,nonce:parseInt(x.nonce,16),data:x.data,chainId:x.chainId};I&&(F.type=2,F.maxFeePerGas=null!=(k=null==(A=x)?void 0:A.maxFeePerGas)?k:void 0,F.maxPriorityFeePerGas=null!=(N=null==(O=x)?void 0:O.maxPriorityFeePerGas)?N:void 0);try{f=yield e.evmSignTransaction(t,n,w({path:r,transaction:x},o))}catch(G){throw new g.o(G)}if(f.success){var E=f.payload,D=E.v,S=E.r,j=E.s,R=Object(s.splitSignature)({v:Number(D),r:S,s:j}),C=Object(c.serialize)(F,R);return{txid:Object(d.keccak256)(C),rawTx:C}}throw Object(h.a)(f.payload)}))).apply(this,arguments)}function F(e,t,n,r,i,a,o,s,d){return E.apply(this,arguments)}function E(){return(E=o()((function*(e,t,n,r,i,a,o,s,d){if(t!==y.C||"address"!==r)return Promise.resolve([]);var c,u=n.length>1;try{c=u?yield e.evmGetAddress(a,o,w({bundle:n.map((function(e){return{path:e,showOnOneKey:!1,chainId:d}}))},s)):yield e.evmGetAddress(a,o,w({path:n[0],showOnOneKey:!1,chainId:d},s))}catch(l){throw new g.o(l)}if(c.success)return c.payload instanceof Array?c.payload.map((function(e){var n=e.path,r=e.address;return{path:n,info:v.b({address:r,impl:t})}})):[{path:c.payload.path,info:v.b({address:c.payload.address,impl:t})}];throw Object(h.a)(c.payload)}))).apply(this,arguments)}}).call(this,n(19).Buffer)},5187:function(e,t,n){"use strict";n.r(t),n.d(t,"IDecodedTxEvmType",(function(){return De})),n.d(t,"default",(function(){return Re}));var r=n(761),i=n.n(r),a=n(3809),o=n.n(a),s=n(773),d=n.n(s),c=n(107),u=n.n(c),l=n(143),f=n.n(l),p=n(16),h=n.n(p),y=n(3810),v=n.n(y),m=n(20),g=n.n(m),x=n(2),T=n.n(x),w=n(10),b=n.n(w),P=n(3),I=n.n(P),k=n(6),A=n.n(k),N=n(9),O=n.n(N),F=n(12),E=n.n(F),D=n(5),S=n.n(D),j=n(293),R=n(27),C=n.n(R),G=n(126),_=n.n(G),B=n(596),L=n(112),V=n(113),K=n(56),U=n(36),M=n(14),H=n(22),W=n(173),J=n(21),z=n(1072),q=n(459),Y=n(957),Z=n(938),X=n(695),Q=n(225),$=n(57),ee=n(3095),te=n(3069),ne=n(316),re=n(616),ie=n(490),ae=n(3068),oe=n(269),se=n(3813),de=n(111),ce=n(3070),ue=n(105);function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S()(e);if(t){var i=S()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var pe="m/44'/"+M.j+"'/0'/0",he=function(e){O()(n,e);var t=fe(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=I()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getAccountPath(),r=yield this.getNetworkChainId(),i=yield this.getHardwareInfo(),a=i.connectId,o=i.deviceId,s=yield this.getWalletPassphraseState();return se.c(t,a,o,n,r,e,s)}));return function(t){return e.apply(this,arguments)}}(),r.signMessage=function(){var e=I()((function*(e,t){var n=yield this.getHardwareSDKInstance(),r=yield this.getAccountPath(),i=yield this.getNetworkChainId(),a=yield this.getHardwareInfo(),o=a.connectId,s=a.deviceId,d=yield this.getWalletPassphraseState();return Promise.all(e.map((function(e){return se.b({HardwareSDK:n,connectId:o,deviceId:s,passphraseState:d,path:r,message:e,chainId:Number(i)})})))}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=I()((function*(e){var t,n=yield this.getHardwareSDKInstance(),r=yield this.getNetworkChainId(),i=yield this.getHardwareInfo(),a=i.connectId,o=i.deviceId,s=yield this.getWalletPassphraseState(),d=e.indexes,c=e.names,u=e.type;if("SEARCH_ACCOUNTS"===u){var l;try{l=yield n.evmGetPublicKey(a,o,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){T()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({path:pe,showOnOneKey:!1,chainId:Number(r)},s))}catch(b){throw H.a.engine.error(b),new J.o(b)}if(!l.success)throw Object(ae.a)(l.payload);var f=l.payload.xpub,p=ue.a.utils.HDNode.fromExtendedKey(f);t=d.map((function(e){return{path:pe+"/"+e,info:oe.b({address:p.derivePath(""+e).address,impl:M.C})}}))}else{var h=d.map((function(e){return pe+"/"+e}));t=yield se.d(n,M.C,h,"address",u,a,o,s,Number(r))}var y=[],v=0;for(var m of t){var g=m.path,x=m.info,w=(c||[])[v]||"EVM #"+(d[v]+1);y.push({id:this.walletId+"--"+g,name:w,type:de.a.SIMPLE,path:g,coinType:M.j,pub:"",address:x}),v+=1}return y}));return function(t){return e.apply(this,arguments)}}(),r.getAddress=function(){var e=I()((function*(e){var t=yield this.getHardwareSDKInstance(),n=yield this.getNetworkChainId(),r=yield this.getHardwareInfo(),i=r.connectId,a=r.deviceId,o=yield this.getWalletPassphraseState();return yield se.a(t,i,a,e.path,e.showOnOneKey,o,Number(n))}));return function(t){return e.apply(this,arguments)}}(),A()(n)}(ce.a),ye=n(297),ve=n(3071);function me(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S()(e);if(t){var i=S()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var ge="m/44'/"+M.j+"'/0'/0",xe=function(e){O()(n,e);var t=me(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=I()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new J.p("EVM signers number should be 1.");if(t[0]!==r.address)throw new J.p("Wrong address required for signing.");var i=(yield this.getPrivateKeys(e))[r.path];if("undefined"===typeof i)throw new J.p("Unable to get signer.");return(n={})[r.address]=new Z.b(i,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=I()((function*(e){var t=e.password,n=e.indexes,r=e.names,i=(yield this.engine.dbApi.getCredential(this.walletId,t)).seed,a=Object(ye.d)("secp256k1",i,t,ge,n.map((function(e){return e.toString()})));if(a.length!==n.length)throw new J.p("Unable to get publick key.");var o=[],s=0;for(var d of a){var c=d.path,u=d.extendedKey.key.toString("hex"),l=yield this.engine.providerManager.addressFromPub(this.networkId,u),f=(r||[])[s]||"EVM #"+(n[s]+1);o.push({id:this.walletId+"--"+c,name:f,type:de.a.SIMPLE,path:c,coinType:M.j,pub:u,address:l}),s+=1}return o}));return function(t){return e.apply(this,arguments)}}(),A()(n)}(ve.a),Te=n(427);function we(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S()(e);if(t){var i=S()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var be=function(e){O()(n,e);var t=we(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.getSigners=function(){var e=I()((function*(e,t){var n,r=yield this.getDbAccount();if(1!==t.length)throw new J.p("EVM signers number should be 1.");if(t[0]!==r.address)throw new J.p("Wrong address required for signing.");var i=Object.values(yield this.getPrivateKeys(e)),a=b()(i,1)[0];return(n={})[r.address]=new Z.b(a,e,"secp256k1"),n}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=I()((function*(e){var t=e.name,n=e.privateKey;if(32!==n.length)throw new J.p("Invalid private key.");var r=Te.c.publicFromPrivate(n).toString("hex"),i=yield this.engine.providerManager.addressFromPub(this.networkId,r);return Promise.resolve([{id:"imported--"+M.j+"--"+r,name:t||"",type:de.a.SIMPLE,path:"",coinType:M.j,pub:r,address:i}])}));return function(t){return e.apply(this,arguments)}}(),A()(n)}(n(3072).a);function Pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S()(e);if(t){var i=S()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var Ie=function(e){O()(n,e);var t=Pe(n);function n(){return t.apply(this,arguments)}var r=n.prototype;return r.signTransaction=function(){var e=I()((function*(e,t){var n,r=null==(n=e.payload)?void 0:n.encodedTx,i=yield this.getDbAccount();return H.a.sendTx.info("KeyringWatching > signTransaction >>>>> ",i.address,r),Promise.resolve({txid:"1111",rawTx:"11118888"})}));return function(t,n){return e.apply(this,arguments)}}(),r.prepareAccounts=function(){var e=I()((function*(e){var t=e.name,n=e.target,r=e.accountIdPrefix,i=yield this.engine.providerManager.verifyAddress(this.networkId,n),a=i.normalizedAddress;if(!i.isValid||"undefined"===typeof a)throw new J.e;return Promise.resolve([{id:r+"--"+M.j+"--"+a,name:t||"",type:de.a.SIMPLE,path:"",coinType:M.j,pub:"",address:a}])}));return function(t){return e.apply(this,arguments)}}(),A()(n)}(n(3073).a),ke=n(2086),Ae=["to","value","data","gas","gasLimit","gasPrice","maxFeePerGas","maxPriorityFeePerGas","nonce"],Ne=["gas","gasLimit"];function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(Object(n),!0).forEach((function(t){T()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S()(e);if(t){var i=S()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return E()(this,n)}}var De,Se=[U.a.optimism,U.a.toptimism];function je(e){var t,n,r,i,a,o;return{feeLimit:null==(t=e.feeLimit)?void 0:t.toFixed(),feePricePerUnit:null==(n=e.feePricePerUnit)?void 0:n.toFixed(),maxPriorityFeePerGas:null==(r=e.payload)||null==(i=r.maxPriorityFeePerGas)?void 0:i.toFixed(),maxFeePerGas:null==(a=e.payload)||null==(o=a.maxFeePerGas)?void 0:o.toFixed()}}!function(e){e.NativeTransfer="NativeTransfer",e.TokenTransfer="TokenTransfer",e.TokenApprove="TokenApprove",e.Swap="Swap",e.NftTransfer="NftTransfer",e.Transaction="Transaction",e.ContractDeploy="ContractDeploy"}(De||(De={}));var Re=function(e){O()(n,e);var t=Ee(n);function n(){for(var e,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=t.call.apply(t,[this].concat(r))).settings=ke.default,e.keyringMap={hd:xe,hw:he,imported:be,watching:Ie,external:Ie},e.decodeTxMemoizee=_()(function(){var t=I()((function*(t,n){return e.decodeTx(t,n)}));return function(e,n){return t.apply(this,arguments)}}(),{promise:!0,primitive:!0,normalizer:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return JSON.stringify(t)},max:1,maxAge:Object(K.b)({minute:3})}),e.isContractAddress=_()(function(){var t=I()((function*(t){try{yield e.validateAddress(t);var n=yield e.getJsonRPCClient();return yield n.isContract(t)}catch(r){return Promise.resolve(!1)}}));return function(e){return t.apply(this,arguments)}}(),{promise:!0,max:50}),e}var r=n.prototype;return r.getEthersProvider=function(){var e=I()((function*(){var e,t,n=yield this.getNetwork(),r=n.rpcURL;return this._ethersProvider&&(null==(e=this._ethersProvider)||null==(t=e.connection)?void 0:t.url)===r||(this._ethersProvider=new ue.a.providers.JsonRpcProvider(n.rpcURL)),this._ethersProvider}));return function(){return e.apply(this,arguments)}}(),r.getJsonRPCClient=function(){var e=I()((function*(){return yield this.engine.providerManager.getClient(this.networkId)}));return function(){return e.apply(this,arguments)}}(),r.decodedTxToLegacy=function(e){throw new Error("decodedTxToLegacy in EVM not implemented.")},r.decodeTx=function(){var e=I()((function*(e,t){var n=yield this.legacyDecodeTx(e,t);return yield this.decodedTxLegacyToModern({decodedTxLegacy:n,encodedTx:e,payload:t})}));return function(t,n){return e.apply(this,arguments)}}(),r.decodeBatchTransferTx=function(){var e=I()((function*(e,t,n){var r,i=re.b.getDecoder(this.engine),a=yield this.helper.parseToNativeTx(t);Number.isFinite(a.chainId)||(a.chainId=Number(yield this.getNetworkChainId()));var o=i.parseBatchTransfer(a),s=b()(o,1)[0];if(!s)return null;var d=[],c=yield this.getNetwork(),u=yield this.getAccountAddress();switch(s.name){case"disperseEther":for(var l=s.args[0],f=s.args[1],p=yield this.engine.getNativeTokenInfo(this.networkId),h=0;h<l.length;h+=1)d.push({type:$.a.NATIVE_TRANSFER,direction:yield this.buildTxActionDirection({from:t.from,to:l[h],address:u}),nativeTransfer:yield this.buildNativeTransferAction({fromAddress:t.from,toAddress:l[h],amount:new C.a(f[h].toString()).shiftedBy(-p.decimals).toFixed(),value:f[h].toString()})});break;case"disperseToken":var y=s.args[0],v=s.args[1],m=s.args[2],g=yield this.engine.ensureTokenInDB(this.networkId,y);if(!g)break;for(var x=0;x<v.length;x+=1)d.push({type:$.a.TOKEN_TRANSFER,direction:yield this.buildTxActionDirection({from:t.from,to:v[x],address:u}),tokenTransfer:yield this.buildTokenTransferAction({info:{token:g,from:t.from,recipient:v[x],amount:new C.a(m[x].toString()).shiftedBy(-g.decimals).toFixed(),amountValue:m[x].toString()}})});break;case"disperseNFT":for(var T=s.args[0],w=s.args[1],P=s.args[2],I=s.args[3],k=0;k<I.length;k+=1){var A,N=(null==n||null==(A=n.nftInfos)?void 0:A[k].asset)||(yield Object(q.d)({accountId:this.accountId,networkId:this.networkId,contractAddress:w[k],tokenId:new C.a(P[k].toString()).toFixed(),local:!0}));N&&d.push({type:$.a.NFT_TRANSFER,direction:yield this.buildTxActionDirection({from:t.from,to:T,address:u}),nftTransfer:yield this.buildNFTTransferAcion({asset:N,amount:new C.a(I[k].toString()).toFixed(),from:t.from,to:T})})}break;default:return null}var O,F=e.gasInfo,E=new C.a(F.gasLimit).toFixed();return O=F.maxFeePerGas?{eip1559:!0,limit:E,price:{baseFee:"0",maxPriorityFeePerGas:new C.a(F.maxPriorityFeePerGas).shiftedBy(-c.feeDecimals).toFixed(),maxPriorityFeePerGasValue:F.maxPriorityFeePerGas,maxFeePerGas:new C.a(F.maxFeePerGas).shiftedBy(-c.feeDecimals).toFixed(),maxFeePerGasValue:F.maxFeePerGas,gasPrice:new C.a(F.gasPrice||F.maxFeePerGas).shiftedBy(-c.feeDecimals).toFixed(),gasPriceValue:F.gasPrice||F.maxFeePerGas}}:{limit:E,price:new C.a(F.gasPrice).shiftedBy(-c.feeDecimals).toFixed(),priceValue:F.gasPrice},{txid:e.txHash,owner:u,signer:t.from||u,nonce:new C.a(null!=(r=t.nonce)?r:0).toNumber(),actions:[].concat(d),status:$.c.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:t,feeInfo:O,payload:n,extraInfo:null}}));return function(t,n,r){return e.apply(this,arguments)}}(),r.legacyDecodeTx=function(){var e=I()((function*(e,t){var n=yield this.helper.parseToNativeTx(e);return Number.isFinite(n.chainId)||(n.chainId=Number(yield this.getNetworkChainId())),re.b.getDecoder(this.engine).decodeTx({vault:this,rawTx:n,payload:t})}));return function(t,n){return e.apply(this,arguments)}}(),r.decodedTxLegacyToModern=function(){var e=I()((function*(e){var t=e.decodedTxLegacy,n=e.encodedTx,r=e.payload,i=e.interactInfo;if(n.to===Y.a[this.networkId]){var a=yield this.decodeBatchTransferTx(t,n,r);if(a)return a}var o,s=yield this.getAccountAddress(),d=yield this.getNetwork(),c=yield this.engine.getNativeTokenInfo(this.networkId),u={type:$.a.UNKNOWN,direction:yield this.buildTxActionDirection({from:t.fromAddress,to:t.toAddress,address:s}),unknownAction:{extraInfo:{}}};if(n.value){var l=new C.a(n.value);!l.isNaN()&&l.gt(0)&&(o={type:$.a.NATIVE_TRANSFER,nativeTransfer:{tokenInfo:c,from:n.from||t.fromAddress,to:n.to,amount:l.shiftedBy(-d.decimals).toFixed(),amountValue:l.toFixed(),extraInfo:null}})}if(t.txType===re.a.NATIVE_TRANSFER&&(u.type=$.a.NATIVE_TRANSFER,u.nativeTransfer=yield this.buildNativeTransferAction(t),o=void 0),t.txType===re.a.TOKEN_TRANSFER&&(u.type=$.a.TOKEN_TRANSFER,u.tokenTransfer=yield this.buildTokenTransferAction(t)),t.txType===re.a.TOKEN_APPROVE){var f,p=t.info;u.type=$.a.TOKEN_APPROVE,u.tokenApprove={tokenInfo:p.token,owner:null!=(f=n.from)?f:s,spender:p.spender,amount:p.amount,amountValue:p.value,isMax:p.isUInt256Max,extraInfo:null}}if(t.txType===re.a.ERC721_TRANSFER||t.txType===re.a.ERC1155_TRANSFER){var h=null;if(null!=r&&r.nftInfo)h=null==r?void 0:r.nftInfo;else if(t.contractCallInfo){var y=t.contractCallInfo,v=y.args||[],m=b()(v,4),g=m[0],x=m[1],T=m[2],w=m[3],P=yield Object(q.d)({accountId:this.accountId,networkId:this.networkId,contractAddress:y.contractAddress,tokenId:T,local:!0});P&&(h={from:g,to:x,amount:new C.a(w).toFixed(),asset:P})}h&&(u.type=$.a.NFT_TRANSFER,u.nftTransfer=yield this.buildNFTTransferAcion(h))}"InternalSwap"===(null==r?void 0:r.type)&&null!=r&&r.swapInfo&&(u.internalSwap=Fe(Fe({},r.swapInfo),{},{extraInfo:null}),u.type=$.a.INTERNAL_SWAP,o=void 0),"InternalStake"===(null==r?void 0:r.type)&&null!=r&&r.stakeInfo&&(u.internalStake=Fe(Fe({},r.stakeInfo),{},{extraInfo:null}),u.type=$.a.INTERNAL_STAKE,o=void 0);var I,k=t.gasInfo,A=new C.a(k.gasLimit).toFixed();return I=k.maxFeePerGas?{eip1559:!0,limit:A,price:{baseFee:"0",maxPriorityFeePerGas:new C.a(k.maxPriorityFeePerGas).shiftedBy(-d.feeDecimals).toFixed(),maxPriorityFeePerGasValue:k.maxPriorityFeePerGas,maxFeePerGas:new C.a(k.maxFeePerGas).shiftedBy(-d.feeDecimals).toFixed(),maxFeePerGasValue:k.maxFeePerGas,gasPrice:new C.a(k.gasPrice||k.maxFeePerGas).shiftedBy(-d.feeDecimals).toFixed(),gasPriceValue:k.gasPrice||k.maxFeePerGas}}:{limit:A,price:new C.a(k.gasPrice).shiftedBy(-d.feeDecimals).toFixed(),priceValue:k.gasPrice},{txid:t.txHash,owner:s,signer:t.fromAddress,nonce:t.nonce||0,actions:[u,o].filter(Boolean),status:$.c.Pending,networkId:this.networkId,accountId:this.accountId,encodedTx:n,payload:r,feeInfo:I,interactInfo:i,extraInfo:{}}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromTransfer=function(){var e=I()((function*(e){var t=yield this.getNetwork(),n=Boolean(e.token),r=e.amount,i=e.tokenId,a=e.isNFT,o=e.type,s=new C.a(r);if(s.isNaN()&&(s=new C.a("0")),n){var d,c;if(a&&o&&i){var u,l=Object(q.a)({type:o,from:e.from,to:e.to,id:i,amount:s.toFixed()});return{from:e.from,to:null!=(u=e.token)?u:"",value:"0x0",data:l}}var f=yield this.engine.ensureTokenInDB(this.networkId,null!=(d=e.token)?d:"");if(!f)throw new Error("Token not found: "+e.token);var p=Object(W.b)(s.shiftedBy(f.decimals)),h=""+ne.d.tokenTransfer+j.b.encode(["address","uint256"],[e.to,p]).slice(2);return{from:e.from,to:null!=(c=e.token)?c:"",value:"0x0",data:h}}var y=Object(W.b)(s.shiftedBy(t.decimals));return{from:e.from,to:e.to,value:y,data:"0x"}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxFromBatchTransfer=function(){var e=I()((function*(e,t){var n,r,i,a=yield this.getNetwork(),o=yield this.getDbAccount(),s=e[0],d=Boolean(s.token),c=s.tokenId,u=s.isNFT,l=s.type,f=void 0!==t?t+1:yield this.getNextNonce(a.id,o),p=Y.a[a.id];if(!p)throw new Error(a.name+" has not deployed a batch transfer contract");var h=new C.a(0);if(d)if(u&&l&&c)n=ne.b.disperseNFT,r=["address","address[]","uint256[]","uint256[]"],i=[s.to].concat(g()(v()(e,(function(e,t){return e[0].push(t.token||""),e[1].push(t.tokenId||""),e[2].push(new C.a("erc1155"===t.type?t.amount:0).toFixed()),e}),[[],[],[]])));else{var y,m=yield this.engine.ensureTokenInDB(this.networkId,null!=(y=s.token)?y:"");if(!m)throw new Error("Token not found: "+s.token);n=ne.b.disperseToken,r=["address","address[]","uint256[]"],i=[m.tokenIdOnNetwork].concat(g()(v()(e,(function(e,t){var n=new C.a(t.amount);return e[0].push(t.to),e[1].push(Object(W.b)(n.shiftedBy(m.decimals))),e}),[[],[]])))}else n=ne.b.disperseEther,r=["address[]","uint256[]"],i=v()(e,(function(e,t){var n=new C.a(t.amount).shiftedBy(a.decimals);return h=h.plus(n),e[0].push(t.to),e[1].push(n.toFixed()),e}),[[],[]]);return{from:s.from,to:p,data:""+n+j.b.encode(r,i).slice(2),value:d?"0x0":Object(W.b)(h),nonce:f}}));return function(t,n){return e.apply(this,arguments)}}(),r.buildEncodedTxFromApprove=function(){var e=I()((function*(e){var t=yield Promise.all([this.getNetwork(),this.engine.ensureTokenInDB(this.networkId,e.token),this.validateAddress(e.spender)]),n=b()(t,3),r=(n[0],n[1]),i=n[2];if("undefined"===typeof r)throw new Error("Token not found: "+e.token);var a=new C.a(e.amount),o=Object(W.b)(a.isNaN()?new C.a(2).pow(256).minus(1):a.shiftedBy(r.decimals)),s=""+ne.d.tokenApprove+j.b.encode(["address","uint256"],[i,o]).slice(2);return{from:e.from,to:e.token,value:"0x0",data:s}}));return function(t){return e.apply(this,arguments)}}(),r.buildEncodedTxsFromSetApproveForAll=function(){var e=I()((function*(e,t){var n=yield this.getNetwork(),r=yield this.getDbAccount(),i=void 0!==t?t+1:yield this.getNextNonce(n.id,r),a=e.map((function(e,t){return{from:e.from,to:e.to,data:""+("erc1155"===e.type?ne.c.setApprovalForAll:ne.e.setApprovalForAll)+j.b.encode(["address","bool"],[e.spender,e.approved]).slice(2),value:"0x0",nonce:i+t}}));return Promise.resolve(a)}));return function(t,n){return e.apply(this,arguments)}}(),r.updateEncodedTx=function(){var e=I()((function*(e,t,n){if(n.type===$.d.tokenApprove){var r=t;return this.updateEncodedTxTokenApprove(e,r.amount)}return n.type===$.d.transfer?this.updateEncodedTxTransfer(e,t):Promise.resolve(e)}));return function(t,n,r){return e.apply(this,arguments)}}(),r.updateEncodedTxTransfer=function(){var e=I()((function*(e,t){var n=yield this.legacyDecodeTx(e),r=t.amount,i=new C.a(r);if(n.txType===re.a.NATIVE_TRANSFER){var a=yield this.getNetwork();e.value=Object(W.b)(i.shiftedBy(a.decimals))}if(n.txType===re.a.TOKEN_TRANSFER){var o=n.info,s=Object(W.b)(i.shiftedBy(o.token.decimals)),d=""+ne.d.tokenTransfer+j.b.encode(["address","uint256"],[o.recipient,s]).slice(2);e.data=d}return e}));return function(t,n){return e.apply(this,arguments)}}(),r.updateEncodedTxTokenApprove=function(){var e=I()((function*(e,t){var n=ne.d.tokenApprove,r=yield this.legacyDecodeTx(e);if(r.txType!==re.a.TOKEN_APPROVE)throw new Error("Not a approve transaction.");var i,a=r.info,o=a.token,s=a.spender;if(t===re.d||t===re.c)i=re.c;else{var d=new C.a(t);if(d.isNaN())throw new Error("Invalid amount input: "+t);i=Object(W.b)(d.shiftedBy(o.decimals))}var c=""+n+j.b.encode(["address","uint256"],[s,i]).slice(2);return Fe(Fe({},e),{},{data:c})}));return function(t,n){return e.apply(this,arguments)}}(),r.buildUnsignedTxFromEncodedTx=function(){var e=I()((function*(e){var t=yield this.getNetwork(),n=yield this.getDbAccount(),r=e.to,i=e.value,a=e.data,o=e.gas,s=e.gasLimit,d=e.gasPrice,c=e.maxFeePerGas,u=e.maxPriorityFeePerGas,l=e.nonce,p=h()(e,Ae);H.a.sendTx.info("buildUnsignedTxFromEncodedTx >>>> encodedTx",e);var y=null!=s?s:o,v=new C.a(null!=l?l:"NaN"),m=v.isNaN()?yield this.getNextNonce(t.id,n):v.toNumber(),g=Object(Z.d)({shiftFeeDecimals:!1,network:t,dbAccount:n,to:r,valueOnChain:i,extra:Fe({data:a,feeLimit:f()(y)?void 0:new C.a(y),feePricePerUnit:f()(d)?void 0:new C.a(d),maxFeePerGas:c,maxPriorityFeePerGas:u,nonce:m},p)});H.a.sendTx.info("buildUnsignedTxFromEncodedTx >>>> fillUnsignedTx",g,je(g));var x=yield this.engine.providerManager.buildUnsignedTx(this.networkId,g);return H.a.sendTx.info("buildUnsignedTxFromEncodedTx >>>> buildUnsignedTx",x,je(x)),e.nonce=m,Fe(Fe({},x),{},{encodedTx:e})}));return function(t){return e.apply(this,arguments)}}(),r._toNormalAmount=function(e,t){var n=ue.a.BigNumber.from(e);return ue.a.utils.formatUnits(n,t)},r.fetchFeeInfo=function(){var e=I()((function*(e){var t,n,r,i,a,o,s,c,l=Fe(Fe({},e),{},{nonce:1,gasPrice:"1"}),f=l.gas,p=l.gasLimit,y=h()(l,Ne),v=yield this.getNetwork(),m=yield this.engine.getGasPrice(this.networkId),g=null==(t=this.settings.subNetworkSettings)?void 0:t[this.networkId];null!=g&&g.isIntegerGasPrice&&(m=m.map((function(e){return u()(e)?new C.a(e).toFixed(0):e})));var x,T=(yield this.decodeTxMemoizee(e)).actions;if(1===T.length&&(null==T||null==(n=T[0])?void 0:n.type)===$.a.NATIVE_TRANSFER)try{x=yield this.buildUnsignedTxFromEncodedTx(Fe(Fe({},y),{},{value:"0x0"}))}catch(S){}if("undefined"===typeof x)try{x=yield this.buildUnsignedTxFromEncodedTx(y)}catch(R){throw H.a.common.error(R),R}var w="0";if(Se.includes(this.networkId)){var b,P,I=ue.a.utils.serializeTransaction({value:e.value,data:e.data,gasLimit:"0x"+(null!=(b=null==(P=x)?void 0:P.feeLimit)?b:new C.a("0")).toString(16),to:e.to,chainId:10,gasPrice:"0xf4240",nonce:1}),k="0x49948e0e"+j.b.encode(["bytes"],[I]).slice(2),A=yield this.getJsonRPCClient(),N=yield A.rpc.call("eth_call",[{to:"0x420000000000000000000000000000000000000F",data:k},"latest"]);w=new C.a(N).shiftedBy(-v.feeDecimals).toFixed()}var O=Boolean((null==(r=m)?void 0:r.length)&&(null==(i=m)?void 0:i.every((function(e){return"object"===typeof e})))),F=new C.a(null!=(a=null!=(o=e.gas)?o:e.gasLimit)?a:0).toFixed(),E=e.gasPrice?this._toNormalAmount(e.gasPrice,v.feeDecimals):void 0;O&&(E=d()(Fe({},m[0]),{maxPriorityFeePerGas:e.maxPriorityFeePerGas?this._toNormalAmount(e.maxPriorityFeePerGas,v.feeDecimals):void 0,maxFeePerGas:e.maxFeePerGas?this._toNormalAmount(e.maxFeePerGas,v.feeDecimals):void 0}));var D=C.a.max(null!=(s=null==(c=x)?void 0:c.feeLimit)?s:"0",null!=f?f:"0",null!=p?p:"0").toFixed();return{nativeSymbol:v.symbol,nativeDecimals:v.decimals,feeSymbol:v.feeSymbol,feeDecimals:v.feeDecimals,eip1559:O,limit:D,prices:m,defaultPresetIndex:"1",tx:{eip1559:O,limit:F,price:E},baseFeeValue:w}}));return function(t){return e.apply(this,arguments)}}(),r.attachFeeInfoToEncodedTx=function(){var e=I()((function*(e){var t=yield this.getNetwork(),n=e.encodedTx,r=e.feeInfoValue,i=Fe({},n);if(f()(r.limit)||(i.gas=Object(W.b)(new C.a(r.limit)),i.gasLimit=Object(W.b)(new C.a(r.limit))),!f()(r.price))if(r.eip1559){var a=r.price;i.maxFeePerGas=Object(W.b)(new C.a(a.maxFeePerGas).shiftedBy(t.feeDecimals)),i.maxPriorityFeePerGas=Object(W.b)(new C.a(a.maxPriorityFeePerGas).shiftedBy(t.feeDecimals)),delete i.gasPrice}else i.gasPrice=Object(W.b)(new C.a(r.price).shiftedBy(t.feeDecimals));return Promise.resolve(i)}));return function(t){return e.apply(this,arguments)}}(),r.mmGetPublicKey=function(){var e=I()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=e.password;if("undefined"===typeof r)throw new J.p("password required");var i=(yield n.getSigners(r,[t.address]))[t.address];return this.engineProvider.mmGetPublicKey(i)}throw new J.k("Only software keryings support getting encryption key.")}));return function(t){return e.apply(this,arguments)}}(),r.mmDecrypt=function(){var e=I()((function*(e,t){var n=yield this.getDbAccount();if(n.id.startsWith("hd-")||n.id.startsWith("imported")){var r=this.keyring,i=t.password;if("undefined"===typeof i)throw new J.p("password required");var a=(yield r.getSigners(i,[n.address]))[n.address];return this.engineProvider.mmDecrypt(e,a)}throw new J.k("Only software keryings support mm decryption.")}));return function(t,n){return e.apply(this,arguments)}}(),r.personalECRecover=function(){var e=I()((function*(e,t){return this.engineProvider.ecRecover({type:Q.b.PERSONAL_SIGN,message:e},t)}));return function(t,n){return e.apply(this,arguments)}}(),r.getTokenAllowance=function(){var e=I()((function*(e,t){var n=yield Promise.all([this.getDbAccount(),this.engine.ensureTokenInDB(this.networkId,e)]),r=b()(n,2),i=r[0],a=r[1];if("undefined"===typeof a)throw new Error;var o="0xdd62ed3e"+j.b.encode(["address","address"],[i.address,t]).slice(2),s=yield this.getJsonRPCClient(),d=yield s.rpc.call("eth_call",[{to:a.tokenIdOnNetwork,data:o},"latest"]);return new C.a(d).shiftedBy(-a.decimals)}));return function(t,n){return e.apply(this,arguments)}}(),r.batchTokensAllowance=function(){var e=I()((function*(e,t){for(var n=[],r=0;r<t.length;r+=1){var i=t[r],a=yield Promise.all([this.getDbAccount(),this.engine.ensureTokenInDB(this.networkId,e)]),o=b()(a,2),s=o[0],d=o[1];if("undefined"===typeof d)throw new Error;var c="0xdd62ed3e"+j.b.encode(["address","address"],[s.address,i]).slice(2);n.push({to:d.tokenIdOnNetwork,data:c})}var u=yield this.getJsonRPCClient();return(yield u.batchEthCall(n)).map((function(e){return Number(e)}))}));return function(t,n){return e.apply(this,arguments)}}(),r.getOutputAccount=function(){var e=I()((function*(){var e=yield this.getDbAccount({noCache:!0});return{id:e.id,name:e.name,type:e.type,path:e.path,coinType:e.coinType,tokens:[],address:e.address,displayAddress:ue.a.utils.getAddress(e.address)}}));return function(){return e.apply(this,arguments)}}(),r.getExportedCredential=function(){var e=I()((function*(e){var t=yield this.getDbAccount();if(t.id.startsWith("hd-")||t.id.startsWith("imported")){var n=this.keyring,r=Object.values(yield n.getPrivateKeys(e)),i=b()(r,1)[0];return"0x"+Object(L.a)(e,i).toString("hex")}throw new J.p("Only credential of HD or imported accounts can be exported")}));return function(t){return e.apply(this,arguments)}}(),r.buildNativeTransferAction=function(){var e=I()((function*(e){return{tokenInfo:yield this.engine.getNativeTokenInfo(this.networkId),from:e.fromAddress,to:e.toAddress,amount:e.amount,amountValue:e.value,extraInfo:null}}));return function(t){return e.apply(this,arguments)}}(),r.buildTokenTransferAction=function(){var e=I()((function*(e){var t,n=yield this.getAccountAddress(),r=e.info;return{tokenInfo:r.token,from:null!=(t=r.from)?t:n,to:r.recipient,amount:r.amount,amountValue:r.value,extraInfo:null}}));return function(t){return e.apply(this,arguments)}}(),r.buildNFTTransferAcion=function(){var e=I()((function*(e){return Promise.resolve({asset:e.asset,amount:e.amount,send:e.from,receive:e.to,extraInfo:null})}));return function(t){return e.apply(this,arguments)}}(),r.proxyJsonRPCCall=function(){var e=I()((function*(e){var t=yield this.getJsonRPCClient();try{return yield t.rpc.call(e.method,e.params)}catch(n){throw Object(Z.c)(n)}}));return function(t){return e.apply(this,arguments)}}(),r.createClientFromURL=function(e){return new B.a(e)},r.fetchTokenInfos=function(e){return this.engine.providerManager.getTokenInfos(this.networkId,e)},r.getAccountNonce=function(){var e=I()((function*(){return yield Object(ie.b)(yield this.getAccountAddress(),this)}));return function(){return e.apply(this,arguments)}}(),r.updatePendingTxs=function(){var e=I()((function*(e){var t=re.b.getDecoder(this.engine),n=e.filter((function(e){return"rawTx"in e})).filter((function(e){return e.status===X.a.PENDING})).map(function(){var e=I()((function*(e){return{entry:e,decodedItem:yield t.decodeHistoryEntry(e)}}));return function(t){return e.apply(this,arguments)}}());if(!n.length)return{};var r=yield Promise.all(n),i=yield this.getTransactionStatuses(r.map((function(e){return e.decodedItem.txHash}))),a=r[0].decodedItem.fromAddress,o=yield Object(ie.b)(a,this),s={};return i.forEach((function(e,t){var n=r[t],i=n.entry,a=n.decodedItem,d=i.id,c=a.nonce;e===V.a.NOT_FOUND||e===V.a.INVALID?!f()(c)&&c<o&&(s[d]=X.a.DROPPED):e===V.a.CONFIRM_AND_SUCCESS?s[d]=X.a.SUCCESS:e===V.a.CONFIRM_BUT_FAILED&&(s[d]=X.a.FAILED)})),Object.keys(s).length>0&&(yield this.engine.dbApi.updateHistoryEntryStatuses(s)),s}));return function(t){return e.apply(this,arguments)}}(),r.mergeDecodedTx=function(){var e=I()((function*(e){var t,n=e.decodedTx,r=(e.encodedTx,e.historyTx),i=(e.rawTx,e.covalentTx),a=(e.rpcReceiptTx,e.nftTxs),o=e.isCovalentApiAvailable,s=yield this.getNetwork();r&&(n=Fe(Fe({},r.decodedTx),{},{encodedTx:null!=(t=n.encodedTx)?t:r.decodedTx.encodedTx}));if(i){var d,c,u=new Date(i.block_signed_at).getTime();n.updatedAt=u,n.createdAt=null!=(d=n.createdAt)?d:u,n.status=i.successful?$.c.Confirmed:$.c.Failed,n.signer=i.from_address||n.signer,n.outputActions=(null==(c=i.parsedDecodedTx)?void 0:c.outputActions)||n.outputActions;var l=new C.a(i.gas_price).toFixed(),f=Object(ee.d)({value:l,network:s}),p=new C.a(i.gas_offered).toFixed(),h=new C.a(i.gas_spent).toFixed(),y={priceValue:l,price:f,limit:p,limitUsed:h};if(n.feeInfo=n.feeInfo||y,n&&n.feeInfo&&(n.feeInfo.limitUsed=h,n.feeInfo.limit=p,n.feeInfo.eip1559)){var v=n.feeInfo.price;v.gasPrice=f,v.gasPriceValue=l}n.isFinal=!0}n.status!==$.c.Pending&&(o||n.createdAt&&Date.now()-n.createdAt>M.t.SET_IS_FINAL_EXPIRED_IN&&(n.isFinal=!0));var m=yield this.getAccountAddress();return n=this.mergeNFTTx({address:m,decodedTx:n,nftTxs:a}),Promise.resolve(n)}));return function(t){return e.apply(this,arguments)}}(),r.mergeNFTTx=function(e){var t=e.address,n=e.decodedTx,r=e.nftTxs;if(r){var i,a=r.map((function(e){return Object(q.b)({transaction:e,address:t})})).filter(Boolean),o=null!=(i=n.outputActions)?i:[],s=null==o?void 0:o.filter((function(e){var t=e.tokenTransfer,n=e.tokenApprove,i=e.nftTransfer;if(t||n||i){var a,o=null!=(a=null==t?void 0:t.tokenInfo)?a:null==n?void 0:n.tokenInfo,s=null==i?void 0:i.asset;if(o){var d=o.tokenIdOnNetwork,c=o.id;if(r.find((function(e){return e.contractAddress===d&&e.tokenId===c})))return!1}if(s)if(r.find((function(e){return(e.contractAddress===s.contractAddress||e.tokenAddress===s.tokenAddress)&&(e.tokenId===s.tokenId||e.contractTokenId===s.contractTokenId)})))return!1}return!0}));n.outputActions=[].concat(g()(s),g()(a))}return n},r.fetchOnChainHistory=function(){var e=I()((function*(e){var t=this,n=e.tokenIdOnNetwork,r=e.localHistory,i=void 0===r?[]:r,a=i.filter((function(e){return e.decodedTx.isFinal})).map((function(e){return e.decodedTx.txid})),s=yield this.getNetworkChainId(),d=yield this.getAccountAddress(),c=yield this.getJsonRPCClient(),l=[],f=[],p=!1;try{var h=yield z.a({chainId:s,address:d,contract:n});p=!0,l=(f=h.data.items).map((function(e){return e.tx_hash}))}catch(x){l=i.filter((function(e){return!!e.isLocalCreated})).map((function(e){return e.decodedTx.txid}))}var y=(l=(l=o()(l,a)).filter(Boolean)).map((function(e){return["eth_getTransactionByHash",[e]]})),v=[];if(y.length)try{v=yield c.rpc.batchCall(y)}catch(x){}var m=yield Object(q.k)(d,this.networkId),g=new Map;return m.forEach((function(e){var t=e.hash,n=g.get(t);n||(n=[]),n.push(e),g.set(t,n)})),(yield Promise.all(l.map(function(){var e=I()((function*(e,r){var a,o,s,c,l=v.find((function(t){return(null==t?void 0:t.hash)===e})),h=Boolean(l);l&&h&&l.input&&!l.data&&(l.data=l.input);var y,m=i.find((function(t){return t.decodedTx.txid===e}));if(null!=m&&null!=(a=m.decodedTx)&&a.isFinal)return null;(l=l||(null==m||null==(o=m.decodedTx)?void 0:o.encodedTx))&&(u()(l.nonce)&&(l.nonce=null!=(y=new C.a(l.nonce).toNumber())?y:0));var T=f.find((function(t){return t.tx_hash===e}));T&&(T=yield z.d({covalentTx:T,address:d,vault:t,encodedTx:l}));var w=null==(s=T)?void 0:s.parsedDecodedTx;if(w=null==(c=T)?void 0:c.parsedDecodedTx,l)try{w=yield t.decodeTx(l,null)}catch(x){}if(!w)return null;var b=g.get(e);return(w=yield t.mergeDecodedTx({decodedTx:w,encodedTx:l,historyTx:m,covalentTx:T,nftTxs:b,isCovalentApiAvailable:p})).tokenIdOnNetwork=n,t.buildHistoryTx({decodedTx:w,encodedTx:l,historyTxToMerge:m})}));return function(t,n){return e.apply(this,arguments)}}()))).filter(Boolean)}));return function(t){return e.apply(this,arguments)}}(),r.checkIsScamHistoryTx=function(){var e=I()((function*(e){try{var t=e.decodedTx,n=t.encodedTx;if(!n)return!1;var r=n.from.toLowerCase(),i=n.to.toLowerCase(),a=(yield this.getAccountAddress()).toLocaleLowerCase();if(r===a||i===a)return!1;for(var o=t.outputActions||t.actions,s=0;s<o.length;s+=1){var d,c,u,l,f=o[s];if(f.type!==$.a.TOKEN_TRANSFER)return!1;if(f.type===$.a.TOKEN_TRANSFER&&null!=(d=f.tokenTransfer)&&d.amount&&!new C.a(null==(c=f.tokenTransfer)?void 0:c.amount).isZero())return!1;if(f.type===$.a.TOKEN_TRANSFER&&null!=(u=f.tokenTransfer)&&u.amount&&new C.a(null==(l=f.tokenTransfer)?void 0:l.amount).isZero()&&[f.tokenTransfer.from.toLocaleLowerCase(),f.tokenTransfer.to.toLocaleLowerCase()].includes(r))return!1}return!0}catch(p){return!1}}));return function(t){return e.apply(this,arguments)}}(),r.fixAddressCase=function(e){return Promise.resolve(i()(e||""))},A()(n)}(te.a)}}]);