(this.webpackJsonp=this.webpackJsonp||[]).push([[847],{5196:function(e,t,n){"use strict";n.r(t);var i=n(1),r=n(52),o=n(508),a=n(42),c=n(1114),s=n(110),d=n(326),u=n(743),l=n(186),b=n(125),f=n(3),h=n.n(f),p=n(744),j=n(457),g=n(10),O=n.n(g),m=n(1109),x=n(41),y=n(32),v=n(387),k=n(3135),I=n(120),w=n(43),S=n(3131),_=n(3137),H=n(142),M=n(15),A=n(20),T=n.n(A),D=n(3065),F=function(e){var t=e.account,n=e.network,r=e.tokenId,a=e.historyFilter,c=Object(o.a)(),s=Object(D.a)(),d=Object(i.useState)(),u=O()(d,2),l=u[0],b=u[1],f=!t||!n,p=Object(i.useCallback)(h()((function*(){var e,i,o={accountId:null!=(e=null==t?void 0:t.id)?e:"",networkId:null!=(i=null==n?void 0:n.id)?i:"",tokenId:r,historyFilter:a,pageNumber:0,pageSize:50},c=function(e){var t=e.filter((function(e){return e.txStatus===I.b.Pending&&!!e.nonce})).reduce((function(e,t){var n=t.nonce;if("undefined"===typeof n)return e;var i=e.get(n);return i?e.set(n,[].concat(T()(i),[t])):e.set(n,[t]),e}),new Map),n=[];return t.forEach((function(e){var t=e.sort((function(e,t){return e.blockSignedAt-t.blockSignedAt}));t.pop(),n.push.apply(n,T()(t.map((function(e){return e.txHash}))))})),e.filter((function(e){return!n.includes(e.txHash)}))}(yield w.a.engine.getTxHistories(o.networkId,o.accountId,{contract:o.tokenId,isHidePending:!!o.tokenId})),s=o.historyFilter;return s&&(c=c.filter((function(e){return s(e)}))),c})),[null==t?void 0:t.id,null==n?void 0:n.id,r,a]);return{isLoading:void 0===l,transactionRecords:l||[],refresh:Object(i.useCallback)(h()((function*(){if(!f){var e=yield p(),t=function(e,t,n){return t?t.sort((function(e,t){return t.blockSignedAt-e.blockSignedAt})).reduce((function(t,i){var r=e;i.txStatus!==I.b.Pending&&(r=n(i.blockSignedAt));var o=t.find((function(e){return e.title===r}));return o||(o={title:r,data:[]},t.push(o)),o.data.push(i),t}),[]).sort((function(t){return t.title===e?-1:1})):[]}(c.formatMessage({id:"history__queue"}),e,(function(e){return s.formatMonth(new Date(e),{hideTheYear:!0})}));b(t)}})),[s,f,c,p])}},L=n(0),P=function(){return Object(L.jsx)(v.a,{},"separator")},C=function(){return Object(L.jsx)(y.a,{h:"20px"},"footer")},R=function(e){var t=e.section,n=t.title,i=t.data;return Object(L.jsx)(y.a,{pb:2,flexDirection:"row",children:Object(L.jsxs)(y.a,{flexDirection:"row",alignItems:"center",children:[Object(L.jsx)(x.h.Subheading,{color:"text-subdued",children:n}),null!=i[0]&&i[0].successful===I.b.Pending&&Object(L.jsx)(y.a,{ml:3,children:Object(L.jsx)(m.a,{title:i.length.toString(),type:"default",size:"sm"})})]})},"section-header")},z=function(e){var t=e.accountId,n=e.networkId,a=e.tokenId,f=e.historyFilter,g=e.headerView,m=e.hiddenHeader,v=e.isTab,I=Object(o.a)(),A=Object(r.u)(),T=Object(i.useState)(),D=O()(T,2),z=D[0],E=D[1],V=Object(i.useState)(),q=O()(V,2),N=q[0],W=q[1],J=Object(S.c)(N),B=J.openAddressDetails,G=J.hasAvailable,Y=F({account:z,network:N,tokenId:a,historyFilter:f}),K=Y.transactionRecords,Q=Y.isLoading,U=Y.refresh,X=Object(j.a)().size,Z=["NORMAL","LARGE"].includes(X)?32:16,$=Object(p.a)().themeVariant;Object(i.useEffect)((function(){function e(){return(e=h()((function*(){if(t){var e=yield w.a.engine.getAccounts([t]);e&&e.length>0&&E(e[0])}}))).apply(this,arguments)}function i(){return(i=h()((function*(){if(n){var e=yield w.a.engine.getNetwork(n);e&&W(e)}}))).apply(this,arguments)}!function(){i.apply(this,arguments)}(),function(){e.apply(this,arguments)}()}),[t,n]),Object(i.useEffect)((function(){U()}),[U]);var ee=Object(L.jsxs)(y.a,{flexDirection:"row",justifyContent:"space-between",alignItems:"center",pb:3,children:[Object(L.jsx)(x.h.Heading,{children:I.formatMessage({id:"transaction__history"})}),Object(L.jsxs)(y.a,{flexDirection:"row",children:[Object(L.jsx)(l.a,{onPress:function(){U()},isLoading:Q,p:2,size:"sm",name:"ArrowPathMini",type:"plain",circle:!0}),G&&Object(L.jsx)(l.a,{onPress:function(){B(null==z?void 0:z.address)},ml:3,p:2,size:"sm",name:"ArrowTopRightOnSquareMini",type:"plain",circle:!0})]})]}),te=m?null:Object(L.jsxs)(L.Fragment,{children:[g,ee]}),ne=v?k.Tabs.SectionList:c.a;return Object(L.jsx)(ne,{bg:"background-default",contentContainerStyle:{paddingHorizontal:Z,marginTop:24},sections:K,renderItem:function(e){var t=e.item,n=e.index,i=e.section;return Object(L.jsx)(b.a.Item,{borderTopRadius:0===n?"12px":"0px",borderRadius:n===i.data.length-1?"12px":"0px",borderWidth:1,borderColor:"light"===$?"border-subdued":"transparent",borderTopWidth:0===n?1:0,borderBottomWidth:n===i.data.length-1?1:0,mb:n===i.data.length-1?6:void 0,onPress:function(){A.navigate(H.c.Modal,{screen:H.b.TransactionDetail,params:{screen:_.TransactionDetailModalRoutes.HistoryDetailModal,params:{decodedItem:t}}})},children:Object(L.jsx)(y.a,{})},t.txHash+"-"+n)},renderSectionHeader:R,ListHeaderComponent:te,ListEmptyComponent:Q?function(){return Object(L.jsx)(s.a,{pb:8,pt:8,children:Object(L.jsx)(d.b,{size:"lg"})})}:function(){return Object(L.jsxs)(y.a,{py:4,flexDirection:"column",alignItems:"center",children:[Object(L.jsx)(u.a,{emoji:"\ud83d\udd50",title:I.formatMessage({id:"transaction__history_empty_title"}),subTitle:I.formatMessage({id:"transaction__history_empty_desc"}),actionTitle:I.formatMessage({id:"action__refresh"}),handleAction:U}),!!M.a.isDev&&Object(L.jsx)(l.a,{onPress:function(){B(null==z?void 0:z.address)},p:2,size:"sm",name:"ArrowTopRightOnSquareMini",type:"plain",circle:!0})]})},ListFooterComponent:C,ItemSeparatorComponent:P,keyExtractor:function(e){return e.txHash},showsVerticalScrollIndicator:!1,stickySectionHeadersEnabled:!1})};z.defaultProps={tokenId:null,historyFilter:void 0,headerView:null,hiddenHeader:!1,isTab:!1};var E=z;t.default=function(){var e=Object(r.u)(),t=Object(r.x)(),n=Object(o.a)(),c=t.params,s=c.tokenId,d=c.historyFilter,u=Object(a.c)(),l=u.accountId,b=u.networkId;return Object(i.useLayoutEffect)((function(){e.setOptions({title:n.formatMessage({id:"transaction__history"})})}),[n,e]),Object(L.jsx)(E,{accountId:l,networkId:b,tokenId:s,historyFilter:d,hiddenHeader:!0})}}}]);